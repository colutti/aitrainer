<div class="h-screen w-screen bg-dark-bg text-text-primary flex flex-col md:flex-row overflow-hidden">
  <app-toast></app-toast>
  @if (isCheckingAuth()) {
    <!-- Loading spinner while checking authentication -->
    <div class="w-full h-full flex items-center justify-center">
      <div class="text-center space-y-4">
        <div class="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-primary"></div>
        <p class="text-text-secondary">Verificando autenticação...</p>
      </div>
    </div>
  } @else if (isOnboarding()) {
    <app-onboarding class="w-full h-full"></app-onboarding>
  } @else if (isAuthenticated()) {
    <!-- Desktop Sidebar -->
    <div
      data-cy="sidebar-wrapper"
      class="hidden md:flex w-64 flex-shrink-0 bg-light-bg border-r border-secondary flex-col"
    >
      <app-sidebar class="h-full block w-full"></app-sidebar>
    </div>

    <!-- Bottom Navigation (Mobile) -->
    <app-bottom-nav></app-bottom-nav>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col overflow-hidden relative z-0 w-full pb-16 md:pb-0">
      @switch (currentView()) {
        @case ('home') {
          <app-dashboard class="h-full block"></app-dashboard>
        }
        @case ('coach') {
          <app-chat class="h-full block"></app-chat>
        }
        @case ('profile') {
          @defer {
            <app-user-profile class="h-full block"></app-user-profile>
          } @loading (minimum 300ms) {
             <div class="h-full p-8 space-y-8">
               <app-skeleton width="200px" height="2rem"></app-skeleton>
               <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                 <app-skeleton height="3rem"></app-skeleton>
                 <app-skeleton height="3rem"></app-skeleton>
                 <app-skeleton height="3rem"></app-skeleton>
               </div>
             </div>
          }
        }
        @case ('trainer-settings') {
          @defer {
            <app-trainer-settings class="h-full block"></app-trainer-settings>
          } @loading (minimum 500ms) {
             <div class="h-full p-8 bg-dark-bg">
                <app-skeleton width="300px" height="2rem" class="mb-4"></app-skeleton>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                   <app-skeleton height="400px"></app-skeleton>
                   <app-skeleton height="400px"></app-skeleton>
                   <app-skeleton height="400px"></app-skeleton>
                   <app-skeleton height="400px"></app-skeleton>
                </div>
             </div>
          }
        }
        @case ('memories') {
          @defer {
            <app-memories class="h-full block"></app-memories>
          } @loading (minimum 500ms) {
            <div class="h-full p-8 space-y-4 animate-pulse">
               <div class="h-8 w-1/3 bg-gray-700 rounded mb-8"></div>
               <div class="h-24 w-full bg-gray-700 rounded"></div>
               <div class="h-24 w-full bg-gray-700 rounded"></div>
            </div>
          }
        }
        @case ('workouts') {
          @defer {
            <app-workouts class="h-full block"></app-workouts>
          } @loading (minimum 500ms) {
             <div class="h-full p-6 space-y-6">
               <div class="flex justify-between items-end">
                 <app-skeleton width="200px" height="2rem"></app-skeleton>
                 <app-skeleton width="150px" height="2rem"></app-skeleton>
               </div>
               <div class="space-y-4">
                 <app-skeleton width="100%" height="80px"></app-skeleton>
                 <app-skeleton width="100%" height="80px"></app-skeleton>
                 <app-skeleton width="100%" height="80px"></app-skeleton>
               </div>
             </div>
          }
        }
        @case ('body') {
          @defer {
            <app-body class="h-full block"></app-body>
          } @loading (minimum 500ms) {
            <div class="h-full p-6 space-y-6">
               <app-skeleton width="100%" height="300px" [borderRadius]="'2rem'"></app-skeleton>
               <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full">
                   <app-skeleton height="200px"></app-skeleton>
                   <app-skeleton height="200px"></app-skeleton>
                   <app-skeleton height="200px"></app-skeleton>
               </div>
               <div class="space-y-4">
                 <app-skeleton width="100%" height="60px"></app-skeleton>
                 <app-skeleton width="100%" height="60px"></app-skeleton>
               </div>
            </div>
          }
        }
        @case ('integrations') {
          @defer {
            <app-integrations class="h-full block"></app-integrations>
          } @loading (minimum 300ms) {
             <div class="h-full p-8 w-full flex flex-col gap-6">
                <app-skeleton width="200px" height="2rem"></app-skeleton>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                  <app-skeleton height="200px"></app-skeleton>
                  <app-skeleton height="200px"></app-skeleton>
                  <app-skeleton height="200px"></app-skeleton>
                </div>
             </div>
          }
        }
        @case ('admin-dashboard') {
          <app-admin-dashboard class="h-full block"></app-admin-dashboard>
        }
        @case ('admin-users') {
          <app-admin-users class="h-full block"></app-admin-users>
        }
        @case ('admin-logs') {
          <app-admin-logs class="h-full block"></app-admin-logs>
        }
        @case ('admin-prompts') {
          <app-admin-prompts class="h-full block"></app-admin-prompts>
        }
      }
    </main>
  } @else {
    <app-login class="w-full h-full"></app-login>
  }
</div>
